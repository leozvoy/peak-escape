<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>峰顶逃生收益计算器</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header class="hero">
      <div>
        <p class="eyebrow">Peak Escape</p>
        <h1>峰顶逃生收益计算器</h1>
        <p class="subtitle">记录每一次涨跌与买卖，实时掌握总价值与盈亏。</p>
      </div>
      <div class="hero-actions">
        <div class="status-pill" id="statusPill">等待输入初始买入价值</div>
        <button id="resetAll" class="ghost reset-button">重置</button>
      </div>
    </header>

    <section class="main-layout">
      <div class="card nodes-card" id="nodesCard">
        <h2>操作节点</h2>
        <p class="muted">每次点击 ➕ 新增一次涨跌与买卖记录。</p>
        <div id="nodesList" class="nodes-list">
          <div class="empty">暂无节点，请点击 ➕ 添加。</div>
        </div>
      </div>

      <div class="chart-section">
        <div class="card chart-card">
          <div class="card-header">
            <h2>走势图</h2>
            <button id="addNode" class="icon-button" title="添加节点" aria-label="添加节点">➕</button>
          </div>
        <div class="summary-panel">
          <div class="summary-main">
            <h3>当前总价值</h3>
            <div class="value" id="totalValue">--</div>
            <div class="summary-metrics">
              <div>
                <span class="label">总盈亏</span>
                <span id="totalProfit">--</span>
              </div>
              <div>
                <span class="label">已实现盈亏</span>
                <span id="realizedProfit">--</span>
              </div>
              <div>
                <span class="label">未实现盈亏</span>
                <span id="unrealizedProfit">--</span>
              </div>
            </div>
          </div>
          <div class="summary-holdings">
            <div>
              <span class="label">当前涨跌</span>
              <span id="currentPrice">--</span>
            </div>
            <div>
              <span class="label">持仓份额</span>
              <span id="currentShares">--</span>
            </div>
          </div>
        </div>
        <div class="chart-placeholder" id="chartPlaceholder">
          <svg id="trendChart" viewBox="0 0 640 300" role="img" aria-label="价格变化与持仓比例折线图">
            <defs>
              <linearGradient id="chartLine" x1="0" x2="1">
                <stop offset="0%" stop-color="#4f46e5" />
                <stop offset="100%" stop-color="#06b6d4" />
              </linearGradient>
            </defs>
            <g id="chartGrid"></g>
            <polyline id="chartLinePath" fill="none" stroke="url(#chartLine)" stroke-width="3" />
            <g id="chartPoints"></g>
            <g id="chartLabels"></g>
            <g id="chartYAxisLabels"></g>
            <text id="chartEmpty" x="320" y="150" text-anchor="middle" class="chart-empty">等待添加节点</text>
            <text class="axis-label" x="320" y="292" text-anchor="middle">持仓比例 (%)</text>
            <text class="axis-label" x="16" y="150" text-anchor="middle" transform="rotate(-90 16 150)">价格变化 (%)</text>
          </svg>
        </div>
        </div>
      </div>
    </section>
  </div>

  <div class="modal" id="nodeModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3>新增节点</h3>
        <button id="closeModal" class="ghost">关闭</button>
      </div>
      <div class="modal-body">
        <label>
          涨/跌幅（%）
          <div class="slider-group">
            <input id="changePercent" type="number" step="0.01" placeholder="例如 10 或 -5" />
            <input id="changePercentSlider" type="range" min="-100" max="100" step="1" value="0" />
          </div>
        </label>
        <label>
          操作类型
          <div class="segmented" role="group" aria-label="操作类型">
            <button type="button" class="segment active" data-type="sell" id="typeSell">卖出</button>
            <button type="button" class="segment" data-type="buy" id="typeBuy">买入</button>
          </div>
        </label>
        <label id="sellPercentField">
          卖出比例（%）
          <div class="slider-group">
            <input id="tradePercent" type="number" min="0" max="100" step="0.01" placeholder="例如 20" />
            <input id="tradePercentSlider" type="range" min="0" max="100" step="1" value="0" />
          </div>
        </label>
        <label id="buyAmountField" class="hidden">
          买入金额
          <input id="buyAmount" type="number" min="0" step="0.01" placeholder="例如 50" />
        </label>
        <p class="muted tip">卖出比例以当前持仓份额为基准；买入金额将按当前价格增加持仓。</p>
      </div>
      <div class="modal-actions">
        <button id="confirmNode" class="primary">确认节点</button>
      </div>
    </div>
  </div>

  <div class="initial-overlay" id="initialOverlay" aria-hidden="false">
    <section class="card initial-card" id="initialCard">
      <h2>输入初始买入价值</h2>
      <p class="muted">请输入买入的价值（无需单位），确认后即可开始添加节点。</p>
      <div class="input-row">
        <input id="initialValue" type="number" min="0" step="0.01" placeholder="例如 100" />
        <button id="confirmInitial" class="primary">确认</button>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
